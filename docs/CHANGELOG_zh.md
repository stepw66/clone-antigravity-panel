[English](../CHANGELOG.md) | 中文文档

# 更新日志

## [2.2.1] - 2025-12-18

### 更改
- **调整配置选项**: 全局将 `gagp` 前缀更名为 `tfa`，并将所有设置项按功能重组为逻辑索引组（看板、状态栏、系统）。
- **仪表盘布局优化**: 细化了仪表盘与文字标签之间的间距，使整体排版更加紧凑、比例更平衡。

### 新增
- **服务恢复工具**: 在侧边栏新增了专属的“重启服务”和“重置状态”按钮，用于快速排查 Agent 无响应及配额同步问题。

### 修复
- **状态栏显示**: 修复了 `resetTime` 无法更新以及 `used`/`remaining` 始终显示百分比的问题。现在它们能正确显示重置时间（如 "2h 30m"）和分数组合（如 "25/100"）[修复 #9]。
- **多语言加载**: 修复了 v2.2.0 中因打包配置问题导致的自动反馈报告中丢失本地化文本（如 `report.*`）的问题 [修复 #5, #8]。
- **测试覆盖**: 新增了自动化测试，确保多语言完整性和状态栏格式的正确性。

## [2.2.0] - 2025-12-18

### 新增
- **模块化仪表盘架构**: 重构了配额可视化系统，采用基于策略的模块化架构，支持多种显示样式。
- **精工业半圆仪表盘**: 实现全新的 210 度“工业级精度”仪表样式，具备多轨道布局及主题自适应配色（已设为默认）。
- **视觉自定义**: 新增 `tfa.quotaDisplayStyle` 设置项，允许用户在“半圆弧”与“经典圆环”样式间自由切换。
- **响应式页脚**: 优化了侧边栏页脚在极端窄宽度下的表现，支持按钮自动换行及布局自适应。

### 改进
- **类型安全升级**: 消除了核心 Webview 组件中的 `any` 类型使用，提升系统稳定性。
- **数学精度优化**: 将 SVG 几何计算提取至独立工具库，并配备了专门的逻辑单元测试。

### 修复
- **侧边栏布局溢出**: 解决了在侧边栏宽度极窄时，底部的控制按钮被截断的问题。

## [2.1.0] - 2025-12-17

### 新增
- **智能反馈 system**: 引入支持多语言的 Bug 报告系统，自动预填充非敏感诊断信息（版本、OS、错误码、进程数）。
- **增强型检测诊断**: `ProcessFinder` 现在能精确识别失败原因：未找到进程、多实例歧义、无端口映射及认证故障。
- **解析异常监控**: 实时监控服务器 API 响应格式，并在解析出错时提供一键反馈入口。
- **国际化框架**: 在逻辑代码层通过 `vscode.l10n` 实现了弹窗消息的 100% 国际化对齐。
- **模型配额细化**: 在状态栏和侧边栏中将 Gemini 3 Flash 从 Gemini Pro 中分离，支持独立追踪。
- **状态栏精简显示**: 使用简短标签（如 "Pro", "Flash"）显示活跃组配额，并增强 Hover 提示以显示所有活跃组的详细信息。
- **社区化集成**: 在侧边栏页脚加入“加入讨论”入口，打通用户反馈与 GitHub Discussions。
- **质量护航**: 引入 Husky 与 lint-staged，在提交前强制执行 ESLint 检查及全量单元测试。

### 改进
- **UI 标题对齐**: 修复侧边栏标题冗余问题（如“工具箱: Toolkit”），现在统一显示为 `Antigravity: 工具箱`。
- **MVVM 架构深化**: 将反馈与诊断逻辑解耦至独立的 `FeedbackManager` 组件，保持 View 层洁净。
- **仪表盘排序控制**: 强制模型饼图按照本地策略配置顺序排列（Gemini Flash 优先显示）。

### 修复
- **UI 显示零点死区**: 解决配额重置时间显示为 "Ready" 时，饼图未及时归位 100% 的同步问题。
- **技术债务清理**: 彻底修复并清零了 ESLint 报告的所有 11+ 项错误与警告。

## [2.0.0] - 2025-12-17

### 改进
- **架构优化**: 重构 `ConfigManager` 和 `WebviewHtmlBuilder` 以提升可测试性
  - 引入 `IConfigReader` 接口实现依赖注入
  - 移除核心模块对 `vscode` 模块的直接依赖
  - 核心业务逻辑现可在纯 Node.js 环境中进行单元测试
- **依赖注入**: `SidebarProvider` 现通过构造函数接收依赖，而非内部创建实例
- **CSP 安全优化**: 提取内联样式到外部 CSS 文件，移除 `'unsafe-inline'`

### 新增
- **新增单元测试**: 为 `ConfigManager` 和 `WebviewHtmlBuilder` 添加全面测试
  - `config_manager.test.ts`: 18 个新测试
  - `html_builder.test.ts`: 13 个新测试
  - 15 个测试文件，152 个测试用例通过

## [1.1.0] - 2025-12-11

### 新增
- **独立缓存轮询**: 缓存大小检查现独立运行，可配置间隔（`gagp.cacheCheckInterval`）
- **缓存警告通知**: 缓存超过阈值时自动警告，24 小时冷却防止刷屏
- **隐藏空文件夹选项**: 新设置项（`gagp.cacheHideEmptyFolders`）可隐藏 Brain 和 Code Tracker 树中的空文件夹

### 改进
- **智能缓存清理**: 保留最新 5 个 brain 任务及其对话，避免中断正在进行的工作
- **清理缓存对话框**: 添加"打开文件夹"按钮用于手动清理
- **删除确认**: Code Tracker 目录删除现显示确认对话框

### 修复
- **Code Tracker 删除按钮**: 修复因 Lit 属性反射问题导致删除按钮不工作的问题
- **删除后树刷新**: 修复文件/文件夹删除后目录树不刷新的问题

## [1.0.3] - 2025-12-10

### 新增
- **MVVM 架构**: 引入 QuotaViewModel 作为统一数据聚合层
- **活跃分组自动检测**: 基于配额消耗变化（>0.1% 阈值）自动检测活跃模型分组
- **缓存优先启动**: UI 立即从缓存渲染，然后异步刷新

### 修复
- **状态栏活跃分组**: 修复活跃分组显示错误（之前因简单字符串匹配导致显示错误分组）
- 修复扩展侧边栏和工具栏中的图标显示问题

## [1.0.2] - 2025-12-10

### 改进
- 扩展包体积减少 85%，加快安装和更新速度
- 提升扩展加载性能

## [1.0.1] - 2025-12-10

### 修复
- 修复配额预测显示在加载后消失的问题
- 修复启动时配额图表渲染问题

### 改进
- 增强代码质量和稳定性

## [1.0.0] - 2025-12-09

### 新增
- 首次发布
- 实时 Gemini API 配额监控，带可视化图表
- Gemini 对话缓存管理
- 快速访问 Gemini 配置文件
- 配额不足时颜色警告（警告/严重阈值）
- 独立追踪并显示 Gemini Pro 与 Gemini Flash 分组
- 可配置轮询间隔自动刷新（最小 60 秒）
- 状态栏集成，显示当前配额使用情况
